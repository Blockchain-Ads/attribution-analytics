import{nanoid as e}from"nanoid";import t from"axios";import n from"js-cookie";import{ethers as i}from"ethers";import r from"jwt-decode";!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}t.b=function(e,t){var n=!0;return _(e,function(e){return n=n&&t(e)}),n},t.s=p,t.t=function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];g(console.warn,e,"WARNING",n)},t.r=v,t.w=function(e){h=!!e},t.m=b,t.n=function(){return d},t.h=y,t.l=I,t.q=O,t.i=C,t.o=function(e){return y(e,o)},t.p=function(e){return y(e,c)},t.j=function(e){return y(e,s)},t.k=function(e){return void 0!==e},t.g=function(e){return(e=window.document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]*)\\s*(;|$)"))?decodeURIComponent(e[2]):null},t.v=function(e,t,n){document.cookie="".concat(e,"=").concat(encodeURIComponent(t)).concat(""!==n?"; expires=".concat(n):"","; path=/")},t.a=function(e,t,n){var o,c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};try{var s=c.method||(n?"POST":"GET");document.createElement("a").href=e;var l,u="object"===r(t)&&null!==t?t:{success:function(){p("ajax","xhr success")},error:function(e){v("ajax","xhr error",null,e)}};"function"==typeof t&&(u.success=t),(o=new window.XMLHttpRequest).onreadystatechange=function(){var e;o.readyState===w&&(200<=(e=o.status)&&e<300||304===e?u.success(o.responseText,o):u.error(o.statusText,o))},o.ontimeout=function(){v("ajax","xhr timeout after ",o.timeout,"ms")},"GET"===s&&n&&(i((l=function(e,t){var n=document.createElement("a");return n.href=t&&"noDecodeWholeURL"in t&&t.noDecodeWholeURL?e:decodeURIComponent(e),t=t&&"decodeSearchAsString"in t&&t.decodeSearchAsString,{href:n.href,protocol:(n.protocol||"").replace(/:$/,""),hostname:n.hostname,port:+n.port,pathname:n.pathname.replace(/^(?!\/)/,"/"),search:t?n.search:function(e){return e?e.replace(/^\?/,"").split("&").reduce(function(e,t){var n=t.split("=");return t=2,n=function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var i,r,a=[],o=!0,c=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){c=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(c)throw r}}return a}}(n,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),t=n[0],n=n[1],/\[\]$/.test(t)?(e[t=t.replace("[]","")]=e[t]||[],e[t].push(n)):e[t]=n||"",e},{}):{}}(n.search||""),hash:(n.hash||"").replace(/^#/,""),host:n.host||window.location.host}}(e,c)).search,n),e=function(e){return(e.protocol||"http")+"://"+(e.host||e.hostname+(e.port?":".concat(e.port):""))+(e.pathname||"")+(e.search?"?".concat(function(e){return Object.keys(e).map(function(t){return Array.isArray(e[t])?e[t].map(function(e){return"".concat(t,"[]=").concat(e)}).join("&"):"".concat(t,"=").concat(e[t])}).join("&")}(e.search||"")):"")+(e.hash?"#".concat(e.hash):"")}(l)),o.open(s,e,!0),c.withCredentials&&(o.withCredentials=!0),_(c.customHeaders,function(e,t){o.setRequestHeader(t,e)}),c.preflight&&o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type",c.contentType||"text/plain"),"POST"===s&&n?o.send(n):o.send()}catch(e){v("ajax","xhr construction",e)}},t.d=function(e,t,n){"loading"!==document.readyState?S(e,t,n):document.addEventListener("DOMContentLoaded",function(){S(e,t,n)})},t.c=function(e){for(var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=function(e,t){if(I(Math.imul))return Math.imul(e,t);var n=(4194303&e)*(t|=0);return 4290772992&e&&(n+=(4290772992&e)*t|0),0|n},r=3735928559^n,a=1103547991^n,o=0;o<e.length;o++)r=i(r^(t=e.charCodeAt(o)),2654435761),a=i(a^t,1597334677);return r=i(r^r>>>16,2246822507)^i(a^a>>>13,3266489909),(4294967296*(2097151&(a=i(a^a>>>16,2246822507)^i(r^r>>>13,3266489909)))+(r>>>0)).toString()},t.f=function(e){var t=/[()-.:;=?_/]/g;return C(e.brands)&&(e.brands=k(e.brands,function(e){return O(e.brand)&&e.brand.search(t)<0})),C(e.fullVersionList)&&(e.fullVersionList=k(e.fullVersionList,function(e){return O(e.brand)&&e.brand.search(t)<0})),e},t.e=function(e,t,n,i,r){for(t=t.split?t.split("."):t,i=0;i<t.length;i++)e=e?e[t[i]]:r;return e===r?n:e},t.u=function(e){for(var t=Object.keys(e),n=t.length,i=new Array(n);n--;)i[n]=[t[n],e[t[n]]];return i};var o="Number",c="Object",s="Boolean",l=Object.prototype.toString,u="TRUE"===m("id5_debug").toUpperCase(),d="TRACE"===m("id5_debug").toUpperCase(),f=Boolean(window.console),h=!1;function p(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];g(console.info,e,"INFO",n)}function v(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];g(console.error,e,"ERROR",n)}function g(e,t,n,i){b()&&f&&e&&e.apply(console,["%cID5 - #".concat(t),"color: #fff; background: #1c307e; padding: 1px 4px; border-radius: 3px;",n].concat(i))}function b(){return u||d||h}function m(e){return null===(e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search))?"":decodeURIComponent(e[1].replace(/\+/g," "))}function y(e,t){return l.call(e)==="[object "+t+"]"}function I(e){return y(e,"Function")}function O(e){return y(e,"String")}function C(e){return y(e,"Array")}function _(e,t){if(!function(e){if(!e)return 1;if(C(e)||O(e))return!(0<e.length);for(var t in e)if(hasOwnProperty.call(e,t))return;return 1}(e)){if(I(e.forEach))return e.forEach(t,this);var n=0,i=e.length;if(0<i)for(;n<i;n++)t(e[n],n,e);else for(n in e)hasOwnProperty.call(e,n)&&t.call(this,e[n],n)}}var w=4;function S(e,t,n){var i=new Image;i.src=e,I(t)&&t(),I(n)&&(i.complete?n():i.addEventListener("load",n))}function k(e,t){var n=[];return _(e,function(e){t(e)&&n.push(e)}),n}},function(e,t){e.exports={STORAGE_CONFIG:{ID5:{name:"id5id",expiresDays:90},LAST:{name:"id5id_last",expiresDays:90},CONSENT_DATA:{name:"id5id_cached_consent_data",expiresDays:30},PD:{name:"id5id_cached_pd",expiresDays:30},SEGMENTS:{name:"id5id_cached_segments",expiresDays:30},PRIVACY:{name:"id5id_privacy",expiresDays:30},LIVE_INTENT:{name:"id5li",expiresDays:90}},LEGACY_COOKIE_NAMES:["id5.1st","id5id.1st"],PRIVACY:{JURISDICTIONS:{gdpr:!0,ccpa:!1,lgpd:!0,other:!1}},ID5_EIDS_SOURCE:"id5-sync.com",LIVE_INTENT_POLL_INTERVAL_MS:500}},function(e,t,n){n.d(t,"a",function(){return v}),n.d(t,"b",function(){return g});var i=n(0),r=(t=n(1),n.n(t)),a=(n(3),["vendorData","ccpaString"]);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d={tcfv1:{objName:"__cmpCall",objKeys:["command","parameter"],returnObjName:"__cmpReturn"},tcfv2:{objName:"__tcfapiCall",objKeys:["command","version"],returnObjName:"__tcfapiReturn"},uspv1:{objName:"__uspapiCall",objKeys:["command","version"],returnObjName:"__uspapiReturn"}},f=Object.freeze({NONE:"none",TCF_V1:"TCFv1",TCF_V2:"TCFv2",USP_V1:"USPv1",ID5_ALLOWED_VENDORS:"ID5"}),h=Object.freeze({FORCE_ALLOWED_BY_CONFIG:"force_allowed_by_config",ID5_CONSENT:"id5_consent",PROVISIONAL:"provisional",JURISDICTION:"jurisdiction",CONSENT_API:"consent_api"}),p=function(){function e(t,n,i){c(this,e),u(this,"allowed",!1),u(this,"grantType",h.NONE),u(this,"api",f.NONE),this.allowed=t,this.grantType=n,this.api=i}return l(e,[{key:"isDefinitivelyAllowed",value:function(){return this.allowed&&this.grantType!==h.PROVISIONAL}}]),e}(),v=function(){function e(){c(this,e),u(this,"api",f.NONE),u(this,"consentString",void 0),u(this,"gdprApplies",!1),u(this,"vendorData",{}),u(this,"allowedVendors",void 0),u(this,"hasCcpaString",!1),u(this,"ccpaString","")}return l(e,[{key:"localStorageGrant",value:function(){return new p(this.isGranted(),h.CONSENT_API,this.api)}},{key:"isGranted",value:function(){switch(this.api){case f.NONE:return!0;case f.TCF_V1:return!this.gdprApplies||!0===Object(i.e)(this,"vendorData.purposeConsents.1");case f.TCF_V2:return!this.gdprApplies||!0===Object(i.e)(this,"vendorData.purpose.consents.1");case f.ID5_ALLOWED_VENDORS:return this.allowedVendors.includes("131");case f.USP_V1:return!0}}},{key:"hashCode",value:function(){var e=function(e,t){if(null==e)return{};var n,i=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)0<=t.indexOf(n=a[i])||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(e),a=0;a<r.length;a++)0<=t.indexOf(n=r[a])||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n]);return i}(this,a);return Object(i.c)(JSON.stringify(e))}}]),e}(),g=function(){function e(t,n,i){c(this,e),u(this,"invocationId",void 0),u(this,"consentData",void 0),u(this,"storedPrivacyData",void 0),u(this,"localStorage",void 0),u(this,"_consentRequested",!1),this.invocationId=t,this.localStorage=n,this.storageConfig=i,this.resetConsentData()}return l(e,[{key:"requestConsent",value:function(e,t,n,r){if(e)this.consentData=new v,Object(i.t)(this.invocationId,"cmpApi: ID5 is operating in forced consent mode and will not retrieve any consent signals from the CMP"),r(this.consentData);else if(this._consentRequested)r(this.consentData);else switch(this.consentData=new v,this._consentRequested=!0,t){case"static":this.parseStaticConsentData(n,r);break;case"iab":this.lookupIabConsent(r);break;default:Object(i.r)(this.invocationId,"cmpApi: Unknown consent API: ".concat(t)),this.resetConsentData(),r(this.consentData)}}},{key:"getOrCreateConsentData",value:function(){return this.consentData||(this.consentData=new v),this.consentData}},{key:"parseStaticConsentData",value:function(t,n){t=t||{};var r={};Object(i.p)(t.getConsentData)?r=e.parseTcfData(t,1):Object(i.p)(t.getTCData)?r=e.parseTcfData(t.getTCData,2):Object(i.i)(t.allowedVendors)?r={api:f.ID5_ALLOWED_VENDORS,allowedVendors:t.allowedVendors.map(function(e){return String(e)}),gdprApplies:!0}:Object(i.p)(t.getUSPData)?r=e.parseUspData(t.getUSPData):Object(i.t)(this.invocationId,"cmpApi: No static consent data detected! Using defaults."),o(this.consentData,r),Object(i.s)(this.invocationId,"cmpApi: Detected API '".concat(this.consentData.api,"' from static consent data"),t),n(this.consentData)}},{key:"lookupIabConsent",value:function(e){var t=this,n=[],i=function(i){return n[i]=!1,function(r){n[i]||(n[i]=!0,r&&o(t.consentData,r),n.every(function(e){return e})&&e(t.consentData))}},r=i(0);i=i(1),this.lookupTcf(r),this.lookupUsp(i)}},{key:"lookupUsp",value:function(t){var n=this,r=(a=e.findUsp()).uspapiFrame,a=a.uspapiFunction;if(!r)return Object(i.t)(this.invocationId,"cmpApi: USP not found! Using defaults for CCPA."),void t();(Object(i.l)(a)?(Object(i.s)(this.invocationId,"cmpApi: Detected USP is directly accessible, calling it now."),a):(Object(i.s)(this.invocationId,"cmpApi: Detected USP is outside the current iframe. Using message passing."),e.buildCmpSurrogate("uspv1",r)))("getUSPData",1,function(r,a){a?t(e.parseUspData(r)):(Object(i.r)(n.invocationId,"cmpApi: USP callback not succesful. Using defaults for CCPA."),t())})}},{key:"lookupTcf",value:function(t){var n=(a=e.findTCF()).cmpVersion,r=a.cmpFrame,a=a.cmpFunction;if(!r)return Object(i.t)(this.invocationId,"cmpApi: TCF not found! Using defaults for GDPR."),void t();Object(i.l)(a)?this.lookupDirectTcf(n,a,t):(Object(i.s)(this.invocationId,"cmpApi: Detected TCF is outside the current iframe. Using message passing."),this.lookupMessageTcf(n,r,t))}},{key:"lookupMessageTcf",value:function(t,n,i){n=e.buildCmpSurrogate(1===t?"tcfv1":"tcfv2",n),this.lookupDirectTcf(t,n,i)}},{key:"lookupDirectTcf",value:function(t,n,r){function a(e,t,n){Object(i.s)(s.invocationId,"cmpApi: TCFv".concat(e," - Received a call back: ").concat(t),n)}function o(e,t){Object(i.r)(s.invocationId,"cmpApi: TCFv".concat(e," - Received insuccess: ").concat(t,". Please check your CMP setup. Using defaults for GDPR."))}var c,s=this,l={},u={},d=function(t){return u[t]=!1,function(n,i){u[t]=!0,i?(a(1,t,n),l[t]=n):o(1,t),Object.values(u).every(function(e){return e})&&r(e.parseTcfData(l,1))}};1===t?(c=d("getConsentData"),d=d("getVendorConsents"),n("getConsentData",null,c),n("getVendorConsents",null,d)):2===t&&n("addEventListener",t,function(t,n){if(a(2,"event",t),!n)return o(2,"addEventListener"),void r();!t||!1!==t.gdprApplies&&"tcloaded"!==t.eventStatus&&"useractioncomplete"!==t.eventStatus||r(e.parseTcfData(t,2))})}},{key:"resetConsentData",value:function(){this.consentData=void 0,this.storedPrivacyData=void 0,this._consentRequested=!1}},{key:"localStorageGrant",value:function(e,t){return!0===e||!0===t?(Object(i.t)(this.invocationId,"cmpApi: Local storage access granted by configuration override, consent will not be checked"),new p(!0,h.FORCE_ALLOWED_BY_CONFIG,f.NONE)):this.consentData&&this.consentData.api!==f.NONE?this.consentData.localStorageGrant():(Object(i.p)(this.storedPrivacyData)||(n=this.localStorage.getItemWithExpiration(this.storageConfig.PRIVACY),this.storedPrivacyData=n&&JSON.parse(n),Object(i.s)(this.invocationId,"cmpApi: Loaded stored privacy data from local storage",this.storedPrivacyData)),this.storedPrivacyData&&!0===this.storedPrivacyData.id5_consent?new p(!0,h.ID5_CONSENT,f.NONE):this.storedPrivacyData&&Object(i.k)(this.storedPrivacyData.jurisdiction)?new p(!1===(n=(n=this.storedPrivacyData.jurisdiction)in r.a.PRIVACY.JURISDICTIONS&&r.a.PRIVACY.JURISDICTIONS[n]),h.JURISDICTION,f.NONE):new p(!0,h.PROVISIONAL,f.NONE));var n}},{key:"setStoredPrivacy",value:function(e){try{Object(i.p)(e)?(this.storedPrivacyData=e,this.localStorage.setItemWithExpiration(this.storageConfig.PRIVACY,JSON.stringify(e))):Object(i.r)(this.invocationId,"cmpApi: Cannot store privacy data if it is not an object",e)}catch(e){Object(i.r)(this.invocationId,"cmpApi: Error while storing privacy data",e)}}}],[{key:"buildCmpSurrogate",value:function(e,t){return function(n,r,a){var o=Math.random()+"",c=d[e],s={},l={};l[c.objKeys[0]]=n,l[c.objKeys[1]]=r,l.callId=o,s[c.objName]=l,l=function e(t){(t=Object(i.e)(t,"data.".concat(c.returnObjName)))&&t.callId===o&&(window.removeEventListener("message",e),a(t.returnValue,t.success))},window.addEventListener("message",l,!1),t.postMessage(s,"*")}}},{key:"parseUspData",value:function(e){if(Object(i.p)(e)&&Object(i.q)(e.uspString))return{api:f.USP_V1,hasCcpaString:!0,ccpaString:e.uspString};Object(i.r)(this.invocationId,"cmpApi: No or malformed USP data. Using defaults for CCPA.")}},{key:"parseTcfData",value:function(t,n){var r,a;if(1===n)r=e.isValidV1ConsentObject,a=e.normalizeV1Data;else{if(2!==n)return void Object(i.r)(this.invocationId,"cmpApi: No or malformed CMP data. Using defaults for GDPR.");r=e.isValidV2ConsentObject,a=e.normalizeV2Data}if(r(t))return a(t);Object(i.r)(this.invocationId,"cmpApi: Invalid CMP data. Using defaults for GDPR.",t)}},{key:"isValidV1ConsentObject",value:function(e){var t=Object(i.e)(e,"getConsentData.gdprApplies");return!!Object(i.j)(t)&&(!1===t||Object(i.q)(e.getConsentData.consentData)&&Object(i.p)(e.getVendorConsents)&&1<Object.keys(e.getVendorConsents).length)}},{key:"isValidV2ConsentObject",value:function(e){var t=e&&e.gdprApplies;return e=e&&e.tcString,!!Object(i.j)(t)&&(!1===t||Object(i.q)(e))}},{key:"normalizeV1Data",value:function(e){return{consentString:e.getConsentData.consentData,vendorData:e.getVendorConsents,gdprApplies:e.getConsentData.gdprApplies,api:f.TCF_V1}}},{key:"normalizeV2Data",value:function(e){return{consentString:e.tcString,vendorData:e,gdprApplies:e.gdprApplies,api:f.TCF_V2}}},{key:"findTCF",value:function(){for(var e,t,n=0,i=window;!e;){try{if("function"==typeof i.__tcfapi||"function"==typeof i.__cmp){t="function"==typeof i.__tcfapi?(n=2,i.__tcfapi):(n=1,i.__cmp),e=i;break}}catch(e){}try{if(i.frames.__tcfapiLocator){n=2,e=i;break}}catch(e){}try{if(i.frames.__cmpLocator){n=1,e=i;break}}catch(e){}if(i===window.top)break;i=i.parent}return{cmpVersion:n,cmpFrame:e,cmpFunction:t}}},{key:"findUsp",value:function(){for(var e,t,n=window;!e;){try{if("function"==typeof n.__uspapi){t=n.__uspapi,e=n;break}}catch(e){}try{if(n.frames.__uspapiLocator){e=n;break}}catch(e){}if(n===window.top)break;n=n.parent}return{uspapiFrame:e,uspapiFunction:t}}}]),e}()},function(e,t,n){function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return a});var r="_exp",a=function(){function e(t){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"available",!1),i(this,"win",void 0),i(this,"writingEnabled",void 0),this.win=t,this.writingEnabled=n,n="__id5test";try{this.writingEnabled&&this.win.localStorage.setItem(n,n),this.win.localStorage.removeItem(n),this.available=!0}catch(t){}}var t;return(t=[{key:"isAvailable",value:function(){return this.available}},{key:"getItem",value:function(e){if(this.available)return this.win.localStorage.getItem(e)}},{key:"setItem",value:function(e,t){this.available&&this.writingEnabled&&this.win.localStorage.setItem(e,t)}},{key:"removeItem",value:function(e){this.available&&this.win.localStorage.removeItem(e)}},{key:"getItemWithExpiration",value:function(e){var t=e.name;return!(e=this.getItem(t+r))||new Date(e).getTime()-Date.now()<=0?(this.removeItemWithExpiration({name:t}),null):this.getItem(t)}},{key:"setItemWithExpiration",value:function(e,t){var n=e.name;e=e.expiresDays,e=Date.now()+864e5*e,e=new Date(e).toUTCString(),this.setItem(n+r,e),this.setItem(n,t)}},{key:"removeItemWithExpiration",value:function(e){this.removeItem(e=e.name),this.removeItem(e+r)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}()},function(e,t){var n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){n.d(t,"a",function(){return s});var i=n(0),r=(t=n(1),n.n(t)),a=n(2);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(t,n,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"invocationId",void 0),c(this,"localStorageGrantChecker",void 0),c(this,"localStorage",void 0),this.invocationId=t,this.localStorageGrantChecker=n,this.localStorage=i,this.storageConfig=r}var t,n,s;return t=e,s=[{key:"makeStoredHash",value:function(e){return Object(i.c)("string"==typeof e?e:"")}},{key:"storedDataMatchesCurrentData",value:function(e,t){return null==e||e===t}}],(n=[{key:"get",value:function(e){try{var t=this.localStorageGrant();if(t.isDefinitivelyAllowed())return this.localStorage.getItemWithExpiration(e);Object(i.t)(this.invocationId,"clientStore.get() has been called without definitive grant",t)}catch(e){Object(i.r)(this.invocationId,e)}}},{key:"clear",value:function(e){try{this.localStorage.removeItemWithExpiration(e)}catch(e){Object(i.r)(this.invocationId,e)}}},{key:"put",value:function(e,t){try{var n=this.localStorageGrant();n.isDefinitivelyAllowed()?this.localStorage.setItemWithExpiration(e,t):Object(i.t)(this.invocationId,"clientStore.put() has been called without definitive grant",n)}catch(e){Object(i.r)(this.invocationId,e)}}},{key:"localStorageGrant",value:function(){return this.localStorageGrantChecker()}},{key:"isLocalStorageAvailable",value:function(){return this.localStorage.isAvailable()}},{key:"getResponseFromLegacyCookie",value:function(){var e;return r.a.LEGACY_COOKIE_NAMES.forEach(function(t){Object(i.g)(t)&&(e=Object(i.g)(t))}),e?JSON.parse(e):null}},{key:"getResponse",value:function(){var e=this.get(this.storageConfig.ID5);return e&&JSON.parse(decodeURIComponent(e))}},{key:"clearResponse",value:function(){this.clear(this.storageConfig.ID5)}},{key:"putResponse",value:function(e){this.put(this.storageConfig.ID5,encodeURIComponent(e))}},{key:"getHashedConsentData",value:function(){return this.get(this.storageConfig.CONSENT_DATA)}},{key:"clearHashedConsentData",value:function(){this.clear(this.storageConfig.CONSENT_DATA)}},{key:"putHashedConsentData",value:function(e){e!==new a.a&&this.put(this.storageConfig.CONSENT_DATA,e.hashCode())}},{key:"getHashedPd",value:function(e){return this.get(this.pdCacheConfig(e))}},{key:"storedPdMatchesPd",value:function(t,n){return e.storedDataMatchesCurrentData(this.getHashedPd(t),e.makeStoredHash(n))}},{key:"clearHashedPd",value:function(e){this.clear(this.pdCacheConfig(e))}},{key:"putHashedPd",value:function(t,n){this.put(this.pdCacheConfig(t),e.makeStoredHash(n))}},{key:"getHashedSegments",value:function(e){return this.get(this.segmentsCacheConfig(e))}},{key:"putHashedSegments",value:function(t,n){this.put(this.segmentsCacheConfig(t),e.makeStoredHash(JSON.stringify(n)))}},{key:"storedSegmentsMatchesSegments",value:function(t,n){return e.storedDataMatchesCurrentData(this.getHashedSegments(t),e.makeStoredHash(JSON.stringify(n)))}},{key:"clearHashedSegments",value:function(e){this.clear(this.segmentsCacheConfig(e))}},{key:"getDateTime",value:function(){return new Date(this.get(this.storageConfig.LAST)).getTime()}},{key:"clearDateTime",value:function(){this.clear(this.storageConfig.LAST)}},{key:"setDateTime",value:function(e){this.put(this.storageConfig.LAST,e)}},{key:"getNb",value:function(e){return(e=this.get(this.nbCacheConfig(e)))?parseInt(e):0}},{key:"clearNb",value:function(e){this.clear(this.nbCacheConfig(e))}},{key:"setNb",value:function(e,t){this.put(this.nbCacheConfig(e),t)}},{key:"incNb",value:function(e,t){return this.setNb(e,++t),t}},{key:"pdCacheConfig",value:function(e){return this.storageConfig.PD.withNameSuffixed(e)}},{key:"nbCacheConfig",value:function(e){return this.storageConfig.ID5.withNameSuffixed(e,"nb")}},{key:"segmentsCacheConfig",value:function(e){return this.storageConfig.SEGMENTS.withNameSuffixed(e)}},{key:"clearAll",value:function(e){this.clearResponse(),this.clearDateTime(),this.clearNb(e),this.clearHashedPd(e),this.clearHashedSegments(e),this.clearHashedConsentData()}},{key:"removeLegacyCookies",value:function(e){var t=new Date(Date.now()-1e3).toUTCString();r.a.LEGACY_COOKIE_NAMES.forEach(function(n){Object(i.v)("".concat(n),"",t),Object(i.v)("".concat(n,"_nb"),"",t),Object(i.v)("".concat(n,"_").concat(e,"_nb"),"",t),Object(i.v)("".concat(n,"_last"),"",t),Object(i.v)("".concat(n,".cached_pd"),"",t),Object(i.v)("".concat(n,".cached_consent_data"),"",t)})}},{key:"storedConsentDataMatchesConsentData",value:function(t){return e.storedDataMatchesCurrentData(this.getHashedConsentData(),t.hashCode())}}])&&o(t.prototype,n),s&&o(t,s),e}()},function(e,t,n){n.d(t,"a",function(){return d});var i=n(0),r=n(1);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}n.n(r);var l=function(){function e(t,n){o(this,e),this.name=t,this.expiresDays=n}return s(e,[{key:"withNameSuffixed",value:function(){for(var t=this.name,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];for(var a=0,o=i;a<o.length;a++){var c=o[a];t+="_".concat(c)}return new e(t,this.expiresDays)}}]),e}(),u=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;function n(e){var n=void 0!==t?Math.max(1,t):e.expiresDays;return new l(e.name,n)}o(this,e);var i=r.STORAGE_CONFIG;this.ID5=n(i.ID5),this.LAST=n(i.LAST),this.CONSENT_DATA=n(i.CONSENT_DATA),this.PD=n(i.PD),this.PRIVACY=n(i.PRIVACY),this.SEGMENTS=n(i.SEGMENTS),this.LIVE_INTENT=n(i.LIVE_INTENT)},d=function(){function e(t,n){if(o(this,e),a(this,"invocationId",void 0),a(this,"options",void 0),a(this,"providedOptions",void 0),a(this,"invalidSegments",void 0),this.invocationId=t,this.options={debugBypassConsent:!1,allowLocalStorageWithoutConsentApi:!1,cmpApi:"iab",consentData:{getConsentData:{consentData:void 0,gdprApplies:void 0},getVendorConsents:{}},refreshInSeconds:7200,partnerId:void 0,partnerUserId:void 0,callbackOnAvailable:void 0,callbackOnUpdates:void 0,callbackTimeoutInMs:void 0,pd:void 0,abTesting:{enabled:!1,controlGroupPct:0},provider:void 0,maxCascades:8,applyCreativeRestrictions:!1,segments:void 0,disableUaHints:!1,disableLiveIntentIntegration:!1,storageExpirationDays:void 0},this.providedOptions={},!n.partnerId||"number"!=typeof n.partnerId)throw new Error("partnerId is required and must be a number");this.invalidSegments=0,this.updOptions(n),this.storageConfig=new u(n.storageExpirationDays)}return s(e,[{key:"getOptions",value:function(){return this.options}},{key:"getProvidedOptions",value:function(){return this.providedOptions}},{key:"getInvalidSegments",value:function(){return this.invalidSegments}},{key:"updOptions",value:function(t){var n=this,r=this;if(Object(i.p)(t)){if(Object(i.o)(this.options.partnerId)&&Object(i.o)(t.partnerId)&&t.partnerId!==this.options.partnerId)throw new Error("Cannot update config with a different partnerId");var a=function(e,t){n.options[e]=t,n.providedOptions[e]=t};Object.keys(t).forEach(function(n){var o,c,s;"segments"===n?(s=t[n],o=[],Object(i.i)(s)?(s.forEach(function(e,t){return t="segments[".concat(t,"]"),Object(i.i)(e.ids)&&Object(i.b)(e.ids,i.q)?e.ids.length<1?(Object(i.r)(r.invocationId,"Config option ".concat(t,".ids should contain at least one segment ID")),void(r.invalidSegments+=1)):Object(i.q)(e.destination)?void o.push(e):(f(r.invocationId,"".concat(t,".destination"),"String",e.destination),void(r.invalidSegments+=1)):(f(r.invocationId,"".concat(t,".ids"),"Array of String",e.ids),void(r.invalidSegments+=1))}),a(n,o)):f(r.invocationId,n,"Array",s)):(c=e.configTypes[n],s=t[n],Object(i.h)(s,c)?a(n,s):f(r.invocationId,n,c,s))})}else Object(i.r)(this.invocationId,"Config options must be an object")}}]),e}();function f(e,t,n,r){Object(i.r)(e,"Config option ".concat(t," must be of type ").concat(n," but was ").concat(toString.call(r),". Ignoring..."))}a(d,"configTypes",{debugBypassConsent:"Boolean",allowLocalStorageWithoutConsentApi:"Boolean",cmpApi:"String",consentData:"Object",refreshInSeconds:"Number",partnerId:"Number",partnerUserId:"String",callbackOnAvailable:"Function",callbackOnUpdates:"Function",callbackTimeoutInMs:"Number",pd:"String",abTesting:"Object",provider:"String",maxCascades:"Number",applyCreativeRestrictions:"Boolean",disableUaHints:"Boolean",disableLiveIntentIntegration:"Boolean",storageExpirationDays:"Number"})},function(e,t,n){n.d(t,"a",function(){return o}),t=n(1);var i=n.n(t),r=n(0);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(3);var o=function(){function e(t,n,o,c,s){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"isEnabled",void 0),a(this,"invocationId",void 0),a(this,"localStorage",void 0),a(this,"storageConfig",void 0),a(this,"_windowObj",void 0),a(this,"_handler",void 0),a(this,"_hasLiveIntentId",!1),a(this,"_liveIntentId",void 0),a(this,"_liveIntentIdTimestamp",void 0);var u=this;this._windowObj=t,this.isEnabled=n,this.invocationId=o,this.localStorage=c,this.storageConfig=s,n&&(this._checkLocalStorage(),Object(r.s)(this.invocationId,"Starting polling detection of LiveIntent API"),this._handler=setInterval(function(){Object(r.e)(l._windowObj,"liQ.ready")&&(Object(r.s)(l.invocationId,"Stopping polling detection of LiveIntent API: found"),clearInterval(u._handler),u._onDetected())},i.a.LIVE_INTENT_POLL_INTERVAL_MS))}var t;return(t=[{key:"_checkLocalStorage",value:function(){var e;this.localStorage.isAvailable()&&(e=this.localStorage.getItemWithExpiration(this.storageConfig.LIVE_INTENT),e=Object(r.q)(e)?JSON.parse(e):void 0,Object(r.p)(e)&&(Object(r.s)(this.invocationId,"Retrieved LiveIntent ID from local storage"),this._setLiveIntentId(e)))}},{key:"_onDetected",value:function(){var e=this;Object(r.s)(this.invocationId,"Detected LiveIntent API on the page! Requesting their ID.");var t=Object(r.e)(this._windowObj,"liQ.resolve");if(Object(r.l)(t))try{t(function(t){Object(r.s)(e.invocationId,"Received LiveIntent API `resolve` lookup response",t),t.unifiedId&&e._setLiveIntentIdFromResponse(t.unifiedId,Date.now())})}catch(t){Object(r.r)("Error caught while calling resolve() on LiveIntent API",t)}}},{key:"_setLiveIntentIdFromResponse",value:function(e,t){t={liveIntentId:e,timestamp:t},this.localStorage.setItemWithExpiration(this.storageConfig.LIVE_INTENT,JSON.stringify(t)),this._setLiveIntentId(t)}},{key:"_setLiveIntentId",value:function(e){Object(r.s)(self.invocationId,"Received LiveIntent ID",e),this._liveIntentId=e.liveIntentId,this._liveIntentIdTimestamp=e.timestamp,this._hasLiveIntentId=!0}},{key:"getLiveIntentId",value:function(){return this.isEnabled?this._liveIntentId:void 0}},{key:"hasLiveIntentId",value:function(){return this.isEnabled&&this._hasLiveIntentId}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),n=n(9),window.ID5||(window.ID5=n.a)},function(e,t,n){var i=n(0),r=n(10),a=n(5),o=n(2),c=n(11),s=n(12),l=n(3),u=n(6),d=n(7),f=n(13);function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var i,r,a=[],o=!0,c=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){c=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(c)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g="https://id5-sync.com";n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),v(this,"loaded",!1),v(this,"_isUsingCdn",!1),v(this,"_referer",!1),v(this,"_version",s.a),v(this,"versions",{}),v(this,"invocationId",0),this.loaded=!0,this._isUsingCdn=!!(document&&document.currentScript&&document.currentScript.src&&0===document.currentScript.src.indexOf("https://cdn.id5-sync.com")),this._referer=Object(r.a)(),this.versions[s.a]=!0}var t;return(t=[{key:"debug",get:function(){return Object(i.m)()},set:function(e){Object(i.w)(e)}},{key:"init",value:function(e){var t=this.invocationId;this.invocationId+=1;try{Object(i.s)(t,"ID5 API version ".concat(this._version,". Invoking init()"),e);var n=new u.a(t,e),r=n.getOptions(),s=new l.a(window.top,!r.applyCreativeRestrictions),f=new d.a(window,!r.disableLiveIntentIntegration,t,s,n.storageConfig),h=new o.b(t,s,n.storageConfig),p=new a.a(t,function(){return h.localStorageGrant(r.allowLocalStorageWithoutConsentApi,r.debugBypassConsent)},s,n.storageConfig),v=new c.a(t,n,p,h,f);return this.getId(v,!1),Object(i.s)(t,"ID5 initialized for partner ".concat(r.partnerId," with referer ").concat(this._referer.referer," and options"),e),v}catch(e){Object(i.r)(t,"Exception caught during init()",e)}}},{key:"refreshId",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!Object(i.j)(t))throw new Error("Invalid signature for refreshId(): second parameter must be a boolean");try{Object(i.s)(e.invocationId,"Invoking refreshId()",arguments),e.startRefresh(t),e.updateOptions(n),e.consentManagement.resetConsentData(),this.getId(e,t)}catch(t){Object(i.r)(e.invocationId,"Exception caught from refreshId()",t)}return e}},{key:"getId",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Object(i.k)(window.navigator.userAgentData)&&!e.getOptions().disableUaHints?this.gatherUaHints().then(function(r){return t.getIdWithUaHints(e,Object(i.f)(r),n)}).catch(function(r){Object(i.r)("Error while calling navigator.userAgentData.getHighEntropyValues()",r),t.getIdWithUaHints(e,void 0,n)}):this.getIdWithUaHints(e,void 0,n)}},{key:"getIdWithUaHints",value:function(e,t,n){var r,a,o=this,c=e.getOptions(),s=0,l=!1,u=!1,d=!1,h=!1,p=e.localStorageGrant();p.isDefinitivelyAllowed()&&(Object(i.s)(e.invocationId,"Using local storage for cached ID",p),r=e.clientStore.getResponse(),a=e.clientStore.getDateTime(),l=a<=0||Date.now()-a>1e3*c.refreshInSeconds,s=e.clientStore.getNb(c.partnerId),u=!e.clientStore.storedPdMatchesPd(c.partnerId,c.pd),d=!e.clientStore.storedSegmentsMatchesSegments(c.partnerId,c.segments)),r||(Object(i.s)(e.invocationId,"No cached ID found"),r=e.clientStore.getResponseFromLegacyCookie(),l=!0),r&&r.universal_uid&&!u&&!d?(Object(i.s)(e.invocationId,"ID5 User ID available from cache:",{storedResponse:r,storedDateTime:a,refreshNeeded:l}),a<=0||12096e5<Date.now()-a||(e.setUserId(r,!0),s=e.clientStore.incNb(c.partnerId,s),h=!0)):r&&r.universal_uid&&u?Object(i.s)(e.invocationId,"PD value has changed, so ignoring User ID from cache"):r&&r.universal_uid&&d?Object(i.s)(e.invocationId,"Segments have changed, so ignoring User ID from cache"):r&&!r.universal_uid?Object(i.r)(e.invocationId,"Invalid stored response: ",r):Object(i.s)(e.invocationId,"No ID5 User ID available from cache"),e.consentManagement.requestConsent(c.debugBypassConsent,c.cmpApi,c.consentData,function(a){var p,v,g=e.localStorageGrant();Object(i.s)(e.invocationId,"Local storage grant",g),g.allowed?(r=e.clientStore.getResponse()||e.clientStore.getResponseFromLegacyCookie(),p=!e.clientStore.storedConsentDataMatchesConsentData(a),e.clientStore.putHashedConsentData(a),e.clientStore.putHashedPd(c.partnerId,c.pd),e.clientStore.putHashedSegments(c.partnerId,c.segments),((g=!r||!r.universal_uid||!r.signature)||l||p||u||d||n)&&(Object(i.s)(e.invocationId,"Decided to fetch a fresh ID5 ID",{missingStoredData:g,refreshInSecondsHasElapsed:l,consentHasChanged:p,pdHasChanged:u,segmentsHaveChanged:d,forceFetch:n}),v=o.gatherData(c,e,s,a,r,t),f.a.gather(e.invocationId).then(function(t){v.extensions=t,o.fetchFreshID5ID(v,c,a,e,n,h)}))):Object(i.s)(e.invocationId,"No legal basis to use ID5",a)})}},{key:"gatherData",value:function(e,t,n,r,a,o){var c={partner:e.partnerId,v:this._version,o:"api",gdpr:r.gdprApplies?1:0,rf:this._referer.referer,u:this._referer.stack[0]||window.location.href,top:this._referer.reachedTop?1:0,localStorage:t.clientStore.isLocalStorageAvailable()?1:0,nbPage:n,id5cdn:this._isUsingCdn,ua:window.navigator.userAgent};return n=r.gdprApplies?r.consentString:void 0,Object(i.k)(n)&&(c.gdpr_consent=n),Object(i.k)(r.allowedVendors)&&(c.allowed_vendors=r.allowedVendors),a=a&&a.signature?a.signature:void 0,Object(i.k)(a)&&(c.s=a),Object(i.k)(o)&&(c.ua_hints=o),r.hasCcpaString&&(c.us_privacy=r.ccpaString),t.liveIntentApi.hasLiveIntentId()&&(c.li=t.liveIntentApi.getLiveIntentId()),Object(i.u)({pd:"pd",partnerUserId:"puid",provider:"provider",segments:"segments"}).forEach(function(t){t=(n=h(t,2))[0];var n=n[1];Object(i.k)(e[t])&&(c[n]=e[t])}),!0===e.abTesting.enabled&&(c.ab_testing={enabled:!0,control_group_pct:t.getOptions().abTesting.controlGroupPct}),0<t.getInvalidSegments()&&(c._invalid_segments=t.getInvalidSegments()),Object(i.n)()&&(c._trace=!0),c}},{key:"fetchFreshID5ID",value:function(e,t,n,r,a,o){var c="".concat(g,"/g/v2/").concat(t.partnerId,".json");Object(i.s)(r.invocationId,"Fetching ID5 ID (forceFetch:".concat(a,") from:"),c,e),Object(i.a)(c,{success:this.handleSuccessfulFetchResponse(r,t,o,n),error:function(e){Object(i.r)(r.invocationId,"Error during AJAX request to ID5 server",e)}},JSON.stringify(e),{method:"POST",withCredentials:!0})}},{key:"handleSuccessfulFetchResponse",value:function(e,t,n,r){var a=this;return function(o){var c=a.validateResponseIsCorrectJson(o,e,"fetch");if(c)if(Object(i.q)(c.universal_uid)){Object(i.s)(e.invocationId,"Valid json response from ID5 received",c);try{e.setUserId(c,!1),e.consentManagement.setStoredPrivacy(c.privacy);var s,l,u,d=e.localStorageGrant();d.isDefinitivelyAllowed()?(Object(i.s)(e.invocationId,"Storing ID in cache"),e.clientStore.putResponse(o),e.clientStore.setDateTime((new Date).toUTCString()),e.clientStore.setNb(t.partnerId,n?0:1)):(Object(i.s)(e.invocationId,"Cannot use local storage to cache ID",d),e.clientStore.clearAll(t.partnerId)),e.clientStore.removeLegacyCookies(t.partnerId),!0===c.cascade_needed&&d.isDefinitivelyAllowed()&&0<=t.maxCascades&&!t.applyCreativeRestrictions&&(s=t.partnerUserId&&0<t.partnerUserId.length,l=r.gdprApplies?r.consentString:void 0,u="".concat(g,"/").concat(s?"s":"i","/").concat(t.partnerId,"/").concat(t.maxCascades,".gif?id5id=").concat(e._userId,"&o=api&").concat(s?"puid="+t.partnerUserId+"&":"","gdpr_consent=").concat(l,"&gdpr=").concat(r.gdprApplies),Object(i.s)(e.invocationId,"Opportunities to cascade available",u),Object(i.d)(u))}catch(o){Object(i.r)(e.invocationId,"Error during processing of valid ID5 server response",c,o)}}else Object(i.r)(e.invocationId,"Server response failed to validate",c)}}},{key:"validateResponseIsCorrectJson",value:function(e,t,n){if(!e||!Object(i.q)(e)||e.length<1)Object(i.r)(t.invocationId,"Empty ".concat(n,' response from ID5 servers: "').concat(e,'"'));else try{return JSON.parse(e)}catch(r){Object(i.r)(t.invocationId,"Cannot parse the JSON server ".concat(n," response"),e)}return null}},{key:"gatherUaHints",value:function(){return window.navigator.userAgentData.getHighEntropyValues(["architecture","fullVersionList","model","platformVersion"])}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}()),t.a=n},function(e,t,n){function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}n.d(t,"a",function(){return a});var r,a=(r=window,function(){try{var e,t=o(),n=t.length-1,i=null!==t[n].location||0<n&&null!==t[n-1].referrer,r=function(e){for(var t,n=[],i=null,r=null,a=null,o=null,c=e.length-1;0<=c;c--){try{i=e[c].location}catch(e){}if(i)n.push(i),o=o||i;else if(0!==c){t=e[c-1];try{r=t.referrer,a=t.ancestor}catch(e){}r?(n.push(r),o=o||r):a?(n.push(a),o=o||a):n.push(null)}else n.push(null)}return{stack:n,detectedRefererUrl:o}}(t);return t[t.length-1].canonicalUrl&&(e=t[t.length-1].canonicalUrl),{referer:r.detectedRefererUrl,reachedTop:i,numIframes:n,stack:r.stack,canonicalUrl:e}}catch(e){}});function o(){var e=function(){var e,t=[];do{try{e=e?e.parent:r;try{var n=e===r.top,a={referrer:e.document.referrer||null,location:e.location.href||null,isTop:n};n&&(a=i(a,{canonicalUrl:function(e){try{var t=e.querySelector("link[rel='canonical']");if(null!==t)return t.href}catch(e){}return null}(e.document)})),t.push(a)}catch(n){t.push({referrer:null,location:null,isTop:e===r.top})}}catch(n){return t.push({referrer:null,location:null,isTop:!1}),t}}while(e!==r.top);return t}(),t=function(){try{return r.location.ancestorOrigins?r.location.ancestorOrigins:void 0}catch(e){}}();if(t)for(var n=0,a=t.length;n<a;n++)e[n].ancestor=t[n];return e}},function(e,t,n){n.d(t,"a",function(){return c}),t=n(1);var i=n.n(t),r=n(0);function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(6),n(5),n(2),n(7);var c=function(){function e(t,n,i,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"_availableCallbackTimerId",void 0),o(this,"_availableCallbackFired",!1),o(this,"_availableCallback",void 0),o(this,"_updateCallback",void 0),o(this,"_refreshCallbackTimerId",void 0),o(this,"_refreshCallbackFired",!1),o(this,"_refreshCallback",void 0),o(this,"_isExposed",void 0),o(this,"_fromCache",void 0),o(this,"_isRefreshing",!1),o(this,"_isRefreshingWithFetch",!1),o(this,"_userId",void 0),o(this,"_linkType",void 0),o(this,"_userIdAvailable",!1),o(this,"invocationId",void 0),o(this,"config",void 0),o(this,"clientStore",void 0),o(this,"consentManagement",void 0),o(this,"liveIntentApi",void 0),this.invocationId=t,this.config=n,this.clientStore=i,this.consentManagement=r,this.liveIntentApi=a}var t,n,c;return t=e,c=[{key:"doFireOnAvailableCallBack",value:function(e){Object(r.s)(e.invocationId,"Id5Status.doFireOnAvailableCallBack"),e._availableCallbackFired=!0,e._availableCallbackTimerId=void 0,e._availableCallback(e)}},{key:"doFireOnUpdateCallBack",value:function(e){Object(r.s)(e.invocationId,"Id5Status.doFireOnUpdateCallBack"),e._updateCallback(e)}},{key:"doFireOnRefreshCallBack",value:function(e){Object(r.s)(e.invocationId,"Id5Status.doFireOnRefreshCallBack"),e._refreshCallbackFired=!0,e._refreshCallbackTimerId=void 0,e._isRefreshing=!1,e._isRefreshingWithFetch=!1,e._refreshCallback(e)}}],(n=[{key:"getOptions",value:function(){return this.config.getOptions()}},{key:"getInvalidSegments",value:function(){return this.config.getInvalidSegments()}},{key:"updateOptions",value:function(e){return this.config.updOptions(e)}},{key:"startRefresh",value:function(e){this._isRefreshing=!0,this._isRefreshingWithFetch=e}},{key:"setUserId",value:function(t,n){var i=this,a=t.universal_uid,o=t.link_type||0;if(this._isExposed=!0,Object(r.p)(t.ab_testing))switch(t.ab_testing.result){case"normal":break;default:case"error":Object(r.r)(this.invocationId,"Id5Status: There was an error with A/B Testing. Make sure controlGroupRatio is a number >= 0 and <= 1");break;case"control":this._isExposed=!1,this.info("User is in control group!")}t=this._userId!==a||this._linkType!==o,this._userIdAvailable=!0,this._userId=a,this._linkType=o,this._fromCache=n,this.info("User id updated, hasChanged: ".concat(t,", fromCache: ").concat(n)),Object(r.l)(this._availableCallback)&&!1===this._availableCallbackFired&&(this._availableCallbackTimerId&&(this.info("Cancelling pending onAvailableCallback watchdog"),clearTimeout(this._availableCallbackTimerId),this._availableCallbackTimerId=void 0),this._availableCallbackTimerId=setTimeout(function(){return e.doFireOnAvailableCallBack(i)},0)),this._isRefreshing&&Object(r.l)(this._refreshCallback)&&!1===this._refreshCallbackFired&&(!1!==n&&!1!==this._isRefreshingWithFetch||(this._refreshCallbackTimerId&&(this.info("Cancelling pending onRefreshCallback watchdog"),clearTimeout(this._refreshCallbackTimerId),this._refreshCallbackTimerId=void 0),this._refreshCallbackTimerId=setTimeout(function(){return e.doFireOnRefreshCallBack(i)},0))),t&&Object(r.l)(this._updateCallback)&&setTimeout(function(){return e.doFireOnUpdateCallBack(i)},0)}},{key:"getUserId",value:function(){return!1===this._isExposed?"0":this._userId}},{key:"getLinkType",value:function(){return!1===this._isExposed?0:this._linkType}},{key:"isFromCache",value:function(){return this._fromCache}},{key:"exposeUserId",value:function(){return this._isExposed}},{key:"getUserIdAsEid",value:function(){return{source:i.a.ID5_EIDS_SOURCE,uids:[{atype:1,id:this.getUserId(),ext:{linkType:this.getLinkType(),abTestingControlGroup:!this.exposeUserId()}}]}}},{key:"onAvailable",value:function(t,n){if(!Object(r.l)(t))throw new Error("onAvailable expect a function");var i;return Object(r.l)(this._availableCallback)?this.info("onAvailable was already called, ignoring"):(this._availableCallback=t,(i=this)._userIdAvailable?(this.info("User id already available firing callback immediately"),this._availableCallbackTimerId=setTimeout(function(){return e.doFireOnAvailableCallBack(i)},0)):0<n&&(this._availableCallbackTimerId=setTimeout(function(){return e.doFireOnAvailableCallBack(i)},n))),this}},{key:"onUpdate",value:function(t){if(!Object(r.l)(t))throw new Error("onUpdate expect a function");this._updateCallback=t;var n=this;return this._userIdAvailable&&setTimeout(function(){return e.doFireOnUpdateCallBack(n)},0),this}},{key:"onRefresh",value:function(t,n){if(!Object(r.l)(t))throw new Error("onRefresh expect a function");this._refreshCallbackTimerId&&(clearTimeout(this._refreshCallbackTimerId),this._refreshCallbackTimerId=void 0),this._refreshCallback=t;var i=this;return!0===this._isRefreshing&&!1===this._isRefreshingWithFetch&&this._userIdAvailable?this._refreshCallbackTimerId=setTimeout(function(){return e.doFireOnRefreshCallBack(i)},0):0<n&&(this._refreshCallbackTimerId=setTimeout(function(){return e.doFireOnRefreshCallBack(i)},n)),this}},{key:"localStorageGrant",value:function(){return this.clientStore.localStorageGrant()}},{key:"info",value:function(e){Object(r.s)(this.invocationId,"Id5Status: "+e)}}])&&a(t.prototype,n),c&&a(t,c),e}()},function(e,t,n){n.d(t,"a",function(){return i});var i="1.0.22"},function(e,t,n){var i=n(0),r=n(14);function a(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){var i,r;t=n[r=t],r in(i=e)?Object.defineProperty(i,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[r]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"gather",value:function(e){function t(t,a){return new r.a(function(r){Object(i.a)(t,{success:function(a){a=function(t,r){try{return JSON.parse(r)}catch(a){return Object(i.r)(e,"Cannot parse the JSON  response from: ".concat(t),r),n}}(t,a),r(a)},error:function(e){Object(i.t)(a,"Got error from ".concat(t," endpoint"),e),r(n)}},null)})}var n={lbCDN:"%%LB_CDN%%"};return r.a.allSettled([t("https://lb.eu-1-id5-sync.com/lb/v1",e),t("https://lbs.eu-1-id5-sync.com/lbs/v1",e)]).then(function(e){var t=n;return e.forEach(function(e){e.value&&(t=o(o({},t),e.value))}),t}).catch(function(t){return Object(i.r)(e,"Got error ".concat(t," when gathering extensions data")),n})}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}()),t.a=n},function(e,t,n){(function(e){var i,r=n(15),a=void 0!==(i=void 0!==e?e:window)&&void 0!==i.Promise?i.Promise:r.a;t.a=a}).call(t,n(4))},function(e,t,n){(function(e){var i=n(19),r=n(20),a=setTimeout;function o(e){return Boolean(e&&void 0!==e.length)}function c(){}function s(e){if(!(this instanceof s))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],p(e,this)}function l(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,s._immediateFn(function(){var n,i=1===e._state?t.onFulfilled:t.onRejected;if(null!==i){try{n=i(e._value)}catch(n){return void d(t.promise,n)}u(t.promise,n)}else(1===e._state?u:d)(t.promise,e._value)})):e._deferreds.push(t)}function u(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof s)return e._state=3,e._value=t,void f(e);if("function"==typeof n)return void p((i=n,r=t,function(){i.apply(r,arguments)}),e)}e._state=1,e._value=t,f(e)}catch(t){d(e,t)}var i,r}function d(e,t){e._state=2,e._value=t,f(e)}function f(e){2===e._state&&0===e._deferreds.length&&s._immediateFn(function(){e._handled||s._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)l(e,e._deferreds[t]);e._deferreds=null}function h(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function p(e,t){var n=!1;try{e(function(e){n||(n=!0,u(t,e))},function(e){n||(n=!0,d(t,e))})}catch(e){if(n)return;n=!0,d(t,e)}}s.prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){var n=new this.constructor(c);return l(this,new h(e,t,n)),n},s.prototype.finally=i.a,s.all=function(e){return new s(function(t,n){if(!o(e))return n(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var r=i.length,a=0;a<i.length;a++)!function e(a,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var c=o.then;if("function"==typeof c)return void c.call(o,function(t){e(a,t)},n)}i[a]=o,0==--r&&t(i)}catch(o){n(o)}}(a,i[a])})},s.allSettled=r.a,s.resolve=function(e){return e&&"object"==typeof e&&e.constructor===s?e:new s(function(t){t(e)})},s.reject=function(e){return new s(function(t,n){n(e)})},s.race=function(e){return new s(function(t,n){if(!o(e))return n(new TypeError("Promise.race accepts an array"));for(var i=0,r=e.length;i<r;i++)s.resolve(e[i]).then(t,n)})},s._immediateFn="function"==typeof e?function(t){e(t)}:function(e){a(e,0)},s._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},t.a=s}).call(t,n(16).setImmediate)},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new a(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new a(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(17),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,n(4))},function(e,t,n){(function(e,t){!function(e,n){var i,r,a,o,c,s,l,u;function d(e){delete r[e]}function f(e){if(a)setTimeout(f,0,e);else{var t=r[e];if(t){a=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{d(e),a=!1}}}}e.setImmediate||(i=1,a=!(r={}),o=e.document,u=(u=Object.getPrototypeOf&&Object.getPrototypeOf(e))&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?c=function(e){t.nextTick(function(){f(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){function t(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(n)&&f(+t.data.slice(n.length))}var n="setImmediate$"+Math.random()+"$";e.addEventListener?e.addEventListener("message",t,!1):e.attachEvent("onmessage",t),c=function(t){e.postMessage(n+t,"*")}}():c=e.MessageChannel?((l=new MessageChannel).port1.onmessage=function(e){f(e.data)},function(e){l.port2.postMessage(e)}):o&&"onreadystatechange"in o.createElement("script")?(s=o.documentElement,function(e){var t=o.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,s.removeChild(t),t=null},s.appendChild(t)}):function(e){setTimeout(f,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return r[i]={callback:e,args:t},c(i),i++},u.clearImmediate=d)}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(4),n(18))},function(e,t){var n,i;function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}e=e.exports={},function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(e){n=r}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,s=[],l=!1,u=-1;function d(){l&&c&&(l=!1,c.length?s=c.concat(s):u=-1,s.length&&f())}function f(){if(!l){var e=o(d);l=!0;for(var t=s.length;t;){for(c=s,s=[];++u<t;)c&&c[u].run();u=-1,t=s.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new h(e,t)),1!==s.length||l||o(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=p,e.addListener=p,e.once=p,e.off=p,e.removeListener=p,e.removeAllListeners=p,e.emit=p,e.prependListener=p,e.prependOnceListener=p,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,n){t.a=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})}},function(e,t,n){t.a=function(e){return new this(function(t,n){if(!e||void 0===e.length)return n(new TypeError(typeof e+" "+e+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var r=i.length,a=0;a<i.length;a++)!function e(n,a){if(a&&("object"==typeof a||"function"==typeof a)){var o=a.then;if("function"==typeof o)return void o.call(a,function(t){e(n,t)},function(e){i[n]={status:"rejected",reason:e},0==--r&&t(i)})}i[n]={status:"fulfilled",value:a},0==--r&&t(i)}(a,i[a])})}}]);const a="BCA-universal-cookie";async function o(e){return new Promise(async(t,n)=>{for(;null==e._userId;)await new Promise(e=>setTimeout(e,300));t(e._userId)})}async function c(c,s){if(void 0===c||"string"!=typeof c)return{result:"",status:{errorCode:1,reason:"bcaWeb3Connect: No address provided to bcaWeb3Connect library argument"}};const l=Math.floor(Date.now()/1e3),u=n.get(a);if(u){const e=function(e){try{return{result:r(e),status:"OK"}}catch(e){return{result:"",status:{errorCode:2,reason:`${e}`}}}}(u);if("OK"==e.status){if(!(e.result.exp+3600<l))return;n.remove(a)}else n.remove(a)}const d=await ID5.init({partnerId:1238}),f=await d.onAvailable(e=>e.getUserId()),h=e(32),p=[t.get("https://www.cloudflare.com/cdn-cgi/trace").then(function(e){const t=e.data.match(/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/)[0];return i.utils.id(`${t}`)}).catch(function(e){console.error("bcaWeb3Connect getHashIP error >>> ",e)}),o(f)],v=await Promise.all(p).then(e=>({result:e,status:"OK"})).catch(e=>({result:"",status:{errorCode:3,reason:`${e}`}}));if("OK"!=v.status)return v;const g={uuid:`${h}`,hashIp:`${v.result[0]}`,id5DeviceId:`${v.result[1]}`,address:c,hostname:window.location.hostname};return await t.post("https://us-central1-web3-cookie.cloudfunctions.net/signup",{dataPackage:g}).then(e=>{const t=e.data.token;return n.set(a,t,{expires:365}),window.localStorage.setItem(a,t),{result:t,status:"OK"}}).catch(function(e){return{result:"",status:{errorCode:4,reason:`${e}`}}})}var s={bcaWeb3Connect:c};export{c as bcaWeb3Connect,s as default};
//# sourceMappingURL=index.modern.js.map
